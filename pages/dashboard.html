<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>WalletHunter ‚Äî –ö–∞–±–∏–Ω–µ—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/main.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    .wrap{max-width:980px;margin:0 auto;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .card{border:1px solid #00ff99;border-radius:12px;padding:12px;text-align:left;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .muted{opacity:.75}
    .title{font-size:18px;font-weight:800;margin:0 0 6px 0;}
    .kv{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(0,255,153,.25);padding:6px 0;}
    .kv:last-child{border-bottom:none;}
    .pill{padding:2px 8px;border:1px solid #00ff99;border-radius:999px;font-size:12px;}
    .adminBtn{border-color:#ffd166;color:#ffd166}
    .btnWide{min-width:220px}
    .navBar{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px;background:rgba(11,11,11,.95);
      border-top:1px solid #00ff99;
      display:flex;gap:10px;justify-content:center;flex-wrap:wrap;
    }
    body{padding-bottom:90px;}
  </style>
  .ticker {
  white-space: nowrap;
  overflow: hidden;
  position: relative;
}

#tickerContent {
  display: inline-block;
  padding-left: 100%;
  animation: tickerMove 18s linear infinite;
}

@keyframes tickerMove {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

</head>

<body>
<div class="wrap">
  <h2>üë§ –ö–∞–±–∏–Ω–µ—Ç</h2>
<!-- –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π -->
<div class="card" style="overflow:hidden;">
  <div id="ticker" class="ticker">
    <div id="tickerContent">
      üîî –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...
    </div>
  </div>
</div>

  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div class="title" id="uTitle">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
        <div class="muted" id="uSub">‚Äî</div>
      </div>

      <div class="row">
        <span class="pill" id="walletStatus">–ö–æ—à–µ–ª—ë–∫: ?</span>
        <button id="adminBtn" class="adminBtn" style="display:none;" onclick="location.href='admin.html'">
          üîß ADMIN
        </button>
      </div>
    </div>
  </div>

  <div class="grid2" style="margin-top:12px;">
    <div class="card">
      <div class="title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</div>
      <div class="kv"><span class="muted">–í—Ä–µ–º—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</span><span><b id="timeMin">0</b> –º–∏–Ω</span></div>
      <div class="kv"><span class="muted">–ó–∞–ø—É—Å–∫–æ–≤</span><span><b id="launches">1</b></span></div>
      <div class="kv"><span class="muted">–®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞</span><span><b id="winChance">1.0</b>%</span></div>
      <div class="kv"><span class="muted">–£—Ä–æ–≤–µ–Ω—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</span><span><b id="genLevel">0</b></span></div>
    </div>

    <div class="card">
      <div class="title">üí∞ –ë–∞–ª–∞–Ω—Å—ã (—Ç–µ—Å—Ç)</div>
      <div class="kv"><span class="muted">3MCoin</span><span><b id="mmcoin">0</b></span></div>
      <div class="kv"><span class="muted">TON</span><span><b id="ton">0</b></span></div>
      <div class="kv"><span class="muted">USDT</span><span><b id="usdt">0</b></span></div>
      <div class="kv"><span class="muted">Stars</span><span><b id="stars">0</b></span></div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="title">üéÆ –ú–µ–Ω—é</div>
    <div class="row">
      <button class="btnWide" onclick="location.href='hunt.html'">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å</button>
      <button class="btnWide" onclick="location.href='mmcoin.html'">üí† 3MCoin</button>
      <button class="btnWide" onclick="location.href='leaderboard.html'">üèÜ –¢–æ–ø</button>
    </div>
    <div class="muted" style="margin-top:8px;">
      –†–µ–∞–ª—å–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏/–≤—ã–ø–ª–∞—Ç—ã –ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ. –°–µ–π—á–∞—Å MVP + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
    </div>
  </div>
</div>

<div class="navBar">
  <button onclick="location.href='dashboard.html'">–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
  <button onclick="location.href='dashboard.html'">–í–æ–∑–≤—Ä–∞—Ç –≤ –∫–æ—à–µ–ª—ë–∫</button>
</div>

<script>
  function renderTicker() {
  const feed = [
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª 0.5 TON",
    "–ù–∞–π–¥–µ–Ω–æ 200 USDT",
    "–ê–ø–≥—Ä–µ–π–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¥–æ lvl 2",
    "–°–∏—Å—Ç–µ–º–∞: —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω"
  ];
  document.getElementById("tickerContent").innerText =
    feed.join("   ‚Ä¢   ");
}

renderTicker();

  // –í–ü–ò–®–ò –°–í–û–ô ID (–ø–æ–ª—É—á–∏—à—å —á–µ—Ä–µ–∑ /myid –≤ –±–æ—Ç–µ)
  const ADMIN_ID = 1901263391;

  const tg = window.Telegram?.WebApp;
  tg?.ready?.();

  function getTgUser() {
    const u = tg?.initDataUnsafe?.user;
    if (u && u.id) return {
      id: u.id,
      username: u.username || "",
      first_name: u.first_name || "",
      last_name: u.last_name || ""
    };
    try {
      const cached = JSON.parse(localStorage.getItem("tg_user") || "null");
      if (cached && cached.id) return cached;
    } catch {}
    return { id: 999000, username: "browser_test", first_name: "Browser", last_name: "" };
  }

  const USERS_KEY = "wh_users";

  function loadUsers() {
    try { return JSON.parse(localStorage.getItem(USERS_KEY) || "{}"); }
    catch { return {}; }
  }
  function saveUsers(obj) {
    localStorage.setItem(USERS_KEY, JSON.stringify(obj));
  }

  function ensureUser(u) {
    const users = loadUsers();
    const id = String(u.id);

    if (!users[id]) {
      users[id] = {
        id: u.id,
        username: u.username || "",
        name: [u.first_name, u.last_name].filter(Boolean).join(" "),
        created_at: Date.now(),
        last_seen: Date.now(),
        launches: 0,
        total_active_ms: 0,
        win_chance: 1.0,
        generator_level: 0,
        bal_mmcoin: 0,
        bal_ton: 0,
        bal_usdt: 0,
        bal_stars: 0,
        wallet_linked: false
      };
    }

    users[id].username = u.username || users[id].username;
    users[id].name = [u.first_name, u.last_name].filter(Boolean).join(" ") || users[id].name;
    users[id].last_seen = Date.now();
    users[id].launches = (users[id].launches || 0) + 1;

    saveUsers(users);
    return users[id];
  }

  // —Å—á–∏—Ç–∞–µ–º –≤—Ä–µ–º—è ‚Äú–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏‚Äù
  let sessionStart = Date.now();
  function flushTime(userObj) {
    const delta = Date.now() - sessionStart;
    sessionStart = Date.now();
    const users = loadUsers();
    const id = String(userObj.id);
    if (!users[id]) return;
    users[id].total_active_ms = Number(users[id].total_active_ms || 0) + Math.max(0, delta);
    users[id].last_seen = Date.now();
    saveUsers(users);
  }

  const tgUser = getTgUser();
  const userObj = ensureUser(tgUser);

  function render() {
    const title = tgUser.username ? `@${tgUser.username}` : (tgUser.first_name || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å");
    document.getElementById("uTitle").textContent = title;
    document.getElementById("uSub").textContent = `ID: ${tgUser.id}`;

    const ws = document.getElementById("walletStatus");
    ws.textContent = userObj.wallet_linked ? "–ö–æ—à–µ–ª—ë–∫: ‚úÖ –ø—Ä–∏–≤—è–∑–∞–Ω" : "–ö–æ—à–µ–ª—ë–∫: ‚ùå –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω";

    document.getElementById("launches").textContent = String(userObj.launches || 1);
    document.getElementById("winChance").textContent = String(Number(userObj.win_chance || 1.0).toFixed(1));
    document.getElementById("genLevel").textContent = String(userObj.generator_level || 0);

    document.getElementById("mmcoin").textContent = String(userObj.bal_mmcoin || 0);
    document.getElementById("ton").textContent = String(userObj.bal_ton || 0);
    document.getElementById("usdt").textContent = String(userObj.bal_usdt || 0);
    document.getElementById("stars").textContent = String(userObj.bal_stars || 0);

    const mins = Math.floor(Number(userObj.total_active_ms || 0) / 60000);
    document.getElementById("timeMin").textContent = String(mins);

    if (Number(tgUser.id) === Number(ADMIN_ID) && ADMIN_ID !== 0) {
      document.getElementById("adminBtn").style.display = "inline-block";
    } else {
      document.getElementById("adminBtn").style.display = "none";
    }
  }

  render();

  // —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è
  setInterval(() => {
    flushTime(userObj);
    const users = loadUsers();
    const refreshed = users[String(tgUser.id)];
    if (refreshed) Object.assign(userObj, refreshed);
    render();
  }, 10000);

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "hidden") flushTime(userObj);
  });

  window.addEventListener("beforeunload", () => flushTime(userObj));
</script>
</body>
</html>
