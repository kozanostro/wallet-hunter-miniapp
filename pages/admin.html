<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>WalletHunter ‚Äî Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/main.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
   <style>
  body {
    font-size: 13px;
  }

  .wrap {
    max-width: 900px;
    margin: 0 auto;
  }

  .card {
    border: 1px solid #00ff99;
    border-radius: 10px;
    padding: 8px;
    margin: 8px 0;
  }

  .title {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .muted {
    opacity: .7;
    font-size: 12px;
  }

  .row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    align-items: center;
  }

  input {
    padding: 4px 6px;
    border-radius: 6px;
    border: 1px solid rgba(0,255,153,.6);
    background: #0b0b0b;
    color: #00ff99;
    font-size: 12px;
    width: 80px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  th, td {
    padding: 4px 6px;
    border-bottom: 1px dashed rgba(0,255,153,.25);
    vertical-align: top;
  }

  th {
    font-weight: 700;
    white-space: nowrap;
  }

  .btnSm {
    padding: 4px 8px;
    font-size: 12px;
  }

  .danger {
    border-color: #ff6b6b;
    color: #ff6b6b;
  }

  .navBar {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    padding: 6px;
    background: rgba(11,11,11,.95);
    border-top: 1px solid #00ff99;
    display: flex;
    justify-content: center;
  }

  body {
    padding-bottom: 60px;
  }
</style>

   

<body>
<div class="wrap">
  <h2>üîß Admin Panel</h2>

  <div id="denied" class="card" style="display:none;">
    <div class="title">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>
    <div class="muted">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –ø–æ Telegram ID + –ø–∞—Ä–æ–ª—å.</div>
    <div style="margin-top:10px;">
      <button onclick="location.href='dashboard.html'">–ù–∞–∑–∞–¥</button>
    </div>
  </div>

  <div id="login" class="card" style="display:none;">
    <div class="title">–í—Ö–æ–¥</div>
    <div class="muted">–ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ–∫–∞ MVP).</div>
    <div class="row" style="margin-top:10px;">
      <input id="pwd" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
      <button class="btnSm" id="btnLogin">–í–æ–π—Ç–∏</button>
      <button class="btnSm danger" id="btnSetPwd">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/—Å–º–µ–Ω–∏—Ç—å</button>
    </div>
    <div class="muted" style="margin-top:8px;" id="pwdHint">‚Äî</div>
  </div>

  <div id="panel" style="display:none;">
    <div class="card">
      <div class="title">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
      <div class="muted">–ú–µ–Ω—è–π win%, generator, –±–∞–ª–∞–Ω—Å—ã. –ù–∞–∂–∏–º–∞–π ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.</div>
      <div class="row" style="margin-top:10px;">
        <button class="btnSm" id="btnRefresh">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:180px;">User</th>
            <th style="width:120px;">Win %</th>
            <th style="width:120px;">Gen lvl</th>
            <th>Balances</th>
            <th style="width:160px;">Actions</th>
          </tr>
        </thead>
        <tbody id="usersTbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="navBar">
  <button onclick="location.href='dashboard.html'">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
</div>

<script>
  const ADMIN_ID = 1901263391; // <-- –í–ü–ò–®–ò –°–í–û–ô ID
  const USERS_KEY = "wh_users";
  const ADMIN_PWD_KEY = "wh_admin_password";

  const tg = window.Telegram?.WebApp;
  tg?.ready?.();

  function getTgUser() {
    const u = tg?.initDataUnsafe?.user;
    if (u && u.id) return u;
    try { return JSON.parse(localStorage.getItem("tg_user") || "null") || { id: 0 }; } catch { return { id: 0 }; }
  }

  function loadUsers() {
    try { return JSON.parse(localStorage.getItem(USERS_KEY) || "{}"); }
    catch { return {}; }
  }
  function saveUsers(obj) {
    localStorage.setItem(USERS_KEY, JSON.stringify(obj));
  }

  function getPwd() { return (localStorage.getItem(ADMIN_PWD_KEY) || "").trim(); }
  function setPwd(p) { localStorage.setItem(ADMIN_PWD_KEY, String(p||"").trim()); }

  const deniedEl = document.getElementById("denied");
  const loginEl = document.getElementById("login");
  const panelEl = document.getElementById("panel");

  const me = getTgUser();
  const isAdminById = (Number(me?.id || 0) === Number(ADMIN_ID)) && ADMIN_ID !== 0;

  function showDenied(){ deniedEl.style.display="block"; loginEl.style.display="none"; panelEl.style.display="none"; }
  function showLogin(){
    deniedEl.style.display="none"; loginEl.style.display="block"; panelEl.style.display="none";
    document.getElementById("pwdHint").textContent = getPwd() ? "–ü–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω." : "–ü–∞—Ä–æ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî –Ω–∞–∂–º–∏ ¬´–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/—Å–º–µ–Ω–∏—Ç—å¬ª.";
  }
  function showPanel(){ deniedEl.style.display="none"; loginEl.style.display="none"; panelEl.style.display="block"; renderUsers(); }

  if (!isAdminById) showDenied(); else showLogin();

  document.getElementById("btnLogin").onclick = () => {
    const entered = (document.getElementById("pwd").value || "").trim();
    const cur = getPwd();
    if (!cur) return alert("–ü–∞—Ä–æ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.");
    if (entered !== cur) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.");
    showPanel();
  };

  document.getElementById("btnSetPwd").onclick = () => {
    const entered = (document.getElementById("pwd").value || "").trim();
    if (entered.length < 4) return alert("–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞.");
    setPwd(entered);
    alert("–ü–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω.");
    showPanel();
  };

  document.getElementById("btnRefresh").onclick = () => renderUsers();

  function renderUsers() {
    const users = loadUsers();
    const ids = Object.keys(users).sort((a,b) => (users[b].last_seen||0) - (users[a].last_seen||0));
    const tb = document.getElementById("usersTbody");
    tb.innerHTML = "";

    for (const id of ids) {
      const u = users[id];
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>
        <div>
        <div>3MC <input ...></div>
        <div>TON <input ...></div>
        <div>USDT <input ...></div>
        <div>‚≠ê <input ...></div>
        </div>
        </td>

        <td><input type="number" step="0.1" min="0" value="${Number(u.win_chance||1).toFixed(1)}" data-id="${id}" data-k="win_chance"></td>
        <td><input type="number" step="1" min="0" value="${Number(u.generator_level||0)}" data-id="${id}" data-k="generator_level"></td>
        <td>
          <div class="row">
            <label class="muted">3MC</label><input type="number" step="1" value="${Number(u.bal_mmcoin||0)}" data-id="${id}" data-k="bal_mmcoin">
            <label class="muted">TON</label><input type="number" step="0.01" value="${Number(u.bal_ton||0)}" data-id="${id}" data-k="bal_ton">
            <label class="muted">USDT</label><input type="number" step="0.01" value="${Number(u.bal_usdt||0)}" data-id="${id}" data-k="bal_usdt">
            <label class="muted">Stars</label><input type="number" step="1" value="${Number(u.bal_stars||0)}" data-id="${id}" data-k="bal_stars">
          </div>
        </td>
        <td>
          <button class="btnSm" data-act="save" data-id="${id}">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </td>
      `;

      tb.appendChild(tr);
    }

    tb.onclick = (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      if (btn.getAttribute("data-act") !== "save") return;
      saveRow(btn.getAttribute("data-id"));
    };
  }

  function saveRow(id) {
    const users = loadUsers();
    if (!users[id]) return;

    const inputs = document.querySelectorAll(`input[data-id="${id}"]`);
    for (const inp of inputs) {
      const k = inp.getAttribute("data-k");
      const v = Number(inp.value);
      if (!k || Number.isNaN(v)) continue;
      users[id][k] = v;
    }
    saveUsers(users);
    alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ.");
  }
</script>
</body>
</html>
